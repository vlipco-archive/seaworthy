#!/bin/bash
set -euo pipefail

if [[ `whoami` != "root" ]]; then
  echo "RUN THIS AS ROOT"
  exit 1
fi

function log() {
  echo -e "--> $1"
}

seaworthydir=$(echo ~vagrant/seaworthy)
godir=$(echo ~vagrant/go)

log "Updating all packages"
yum update -y

log "Adding vagrant to the docker group"
usermod -a -G docker vagrant

#log "Setting permissions for /vagrant"
#chown -R vagrant:vagrant /vagrant

#if [[ ! -e "$seaworthydir" ]]; then
  #log "Linking vagrant folder as seaworthy under $HOME"
  #ln -s /vagrant $seaworthydir
#fi

log "Creating $HOME/go (to be used as GOPATH)"
mkdir -p $godir

log "Configuring environment for vagrant"

target=$(echo ~vagrant/.zsh.after/gopath.zsh)
touch $target
chmod +x $target

if [[ $(cat $target | grep GOPATH) == "" ]]; then
  echo 'export GOPATH='$godir >> $target
  echo 'export PATH=$GOPATH/bin:$PATH' >> $target
else
  echo "vagrant's environment is already configured"
fi

#chown -R vagrant:vagrant ~vagrant
sudo docker pull vlipco/hull