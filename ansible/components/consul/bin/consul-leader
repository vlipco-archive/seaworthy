#!/bin/bash
set -eo pipefail
if curl -s "http://127.0.0.1:8500" &> /dev/null; then
	leader=$(curl -s "http://127.0.0.1:8500/v1/status/leader" --max-time 1)
	# remove the quotes & roughly check for the format
	leader=$(echo $leader | jq -r '.' | grep -E '^([0-9]|\.|:)*$')

	if [[ -n "$leader" ]] ; then
		echo $leader
		exit 0
	else
		echo "null"
		exit 1
	fi
else
	echo "No local connection to consul on port 8500"
	exit 1
fi