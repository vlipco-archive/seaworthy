#!/bin/bash

usage() { echo "Usage: $0 -p <passfile> key [value]" 1>&2; exit 1; }

while getopts ":p:" opt; do
    case "${opt}" in
        p)
            passfile=${OPTARG} ;;
        *)
            usage ;;
    esac
done

shift $((OPTIND-1))

if [ -z "${passfile}" ] || [ -z "${1}" ]; then
    usage

elif [ -z "${2}" ]; then
	./consulkv "$1" | ./aes256 dec $passfile
else
	ciphered=$(echo "$2" | ./aes256 enc $passfile)
	echo $ciphered
	./consulkv "$1" "$ciphered"
fi
