#!/bin/bash
set -eo pipefail

if consul-leader &> /dev/null; then
	if [[ -z "$2" ]]; then
		# no channel was given as second param
		channel="$(hostname).$$#ephemeral"
	else
		channel="$2"
	fi
	exec nsq_tail `lookupd-params http` \
		--channel=$channel \
		--topic=$1 2> /dev/null
else
	echo "No cluster leader"
	exit 1
fi