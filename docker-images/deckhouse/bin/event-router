#!/bin/bash
set -eo pipefail

# via http://www.serfdom.io/docs/recipes/event-handler-router.html

handler_dir="/srv/serf"

if [[ "$SERF_EVENT" = "user" ]]; then
    event="user-$SERF_USER_EVENT"
elif [[ "$SERF_EVENT" = "query" ]]; then
    event="query-$SERF_QUERY_NAME"
else
    event=$SERF_EVENT
fi

cd $handler_dir
pluginhook $event